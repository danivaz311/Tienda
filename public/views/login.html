<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iniciar SesiÃ³n | BookStore</title>
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="stylesheet" href="../css/forms.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <!-- REEMPLAZAR ESTE HEADER -->
  <header>
    <nav class="navbar">
      <a href="index.html" class="logo-link">
        <div class="logo">ðŸ“š BookStore</div>
      </a>
      <ul class="nav-links nav-menu">
        <li class="nav-item"><a href="index.html" class="nav-link">Inicio</a></li>
        <li class="nav-item"><a href="registro.html" class="nav-link">Registro</a></li>
        <a href="carrito.html" class="nav-link">
          Carrito <span id="cart-count" class="cart-badge">0</span>
        </a>
        <li class="auth-only nav-item"><a href="orden-confirmada.html" class="nav-link">Orden Confirmada</a></li>
        <li class="auth-only nav-item"><a href="historial.html" class="nav-link">Historial</a></li>
        <li class="nav-item"><a href="login.html" id="login-link" class="nav-link">Login</a></li>
        <li class="auth-only nav-item"><a href="#" id="logout-link" class="nav-link">Cerrar sesiÃ³n</a></li>
      </ul>
      <div class="hamburger">â˜°</div>
    </nav>
  </header>

  <!-- MantÃ©n el resto del contenido -->
  <main class="login-container">
    <div class="login-card">
      <h2><i class="fas fa-sign-in-alt"></i> Iniciar SesiÃ³n</h2>
      <form id="loginForm" class="login-form">
        <div class="form-group">
          <label for="correo"><i class="fas fa-envelope"></i> Correo ElectrÃ³nico</label>
          <input type="email" id="correo" name="correo" placeholder="tu@email.com" required />
        </div>
        <div class="form-group">
          <label for="contrasena"><i class="fas fa-lock"></i> ContraseÃ±a</label>
          <input type="password" id="contrasena" name="contrasena" placeholder="Tu contraseÃ±a" required />
        </div>
        <button type="submit" class="login-button">
          <i class="fas fa-sign-in-alt"></i> Iniciar SesiÃ³n
        </button>
      </form>
      <div id="mensaje" class="message"></div>
      <div class="login-links">
        <p>Â¿No tienes cuenta? <a href="registro.html">RegÃ­strate aquÃ­</a></p>
        <p><a href="#">Â¿Olvidaste tu contraseÃ±a?</a></p>
      </div>
    </div>
  </main>

  <!-- NotificaciÃ³n flotante (para consistencia con index.html) -->
  <div id="notification" class="notification"></div>

  <footer class="footer">
    <p>&copy; 2025 BookStore - Todos los derechos reservados</p>
  </footer>

  <!-- Scripts necesarios -->
  <script src="../js/login.js"></script>
  <script src="../js/index.js"></script>
  <script>
    // Al iniciar sesiÃ³n exitosamente:

    async function handleLogin(e) {
      e.preventDefault();
      
      // Guardar referencia al carrito actual antes de iniciar sesiÃ³n
      const carritoActual = localStorage.getItem('carrito');
      
      // Resto del cÃ³digo de inicio de sesiÃ³n...
      
      if (response.ok) {
        const data = await response.json();
        localStorage.setItem('token', data.token);
        
        // Mostrar notificaciÃ³n
        showNotification('Â¡Inicio de sesiÃ³n exitoso!');
        
        // Si habÃ­a un carrito guardado para este usuario, recuperarlo
        try {
          const payload = JSON.parse(atob(data.token.split('.')[1]));
          const userId = payload.id;
          const carritoGuardado = localStorage.getItem(`carrito_${userId}`);
          
          // Decidir quÃ© carrito usar - priorizar el carrito guardado del usuario
          if (carritoGuardado) {
            localStorage.setItem('carrito', carritoGuardado);
          } else if (carritoActual) {
            // Si el usuario no tenÃ­a carrito guardado pero hay uno actual, guardarlo para Ã©l
            localStorage.setItem(`carrito_${userId}`, carritoActual);
          }
        } catch (error) {
          console.error('Error al recuperar carrito al iniciar sesiÃ³n:', error);
        }
        
        // Redireccionar
        setTimeout(() => {
          window.location.href = redirectUrl;
        }, 1500);
      }
    }
  </script>
</body>
</html>
